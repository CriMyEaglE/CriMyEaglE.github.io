(()=>{"use strict";var e={d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>U});const t=document.querySelector(".profile__edit-button"),r=document.querySelector("#addButton"),o=document.querySelector(".profile__name"),n=document.querySelector(".profile__description"),a=document.querySelector("#addFormPopup"),s=a.querySelector("#title-input"),c=a.querySelector("#url-input"),i=document.querySelector(".cards"),l=document.querySelector("#editFormPopup"),d=l.querySelector("#name-input"),u=l.querySelector("#job-input"),m=document.querySelector("#fullscreenImagePopup"),_=document.querySelector(".profile__avatar"),p=document.querySelector("#avatarPopup"),v=p.querySelector("#url-input"),f=m.querySelector(".fullscreen__image"),b=m.querySelector(".fullscreen__title"),h=document.querySelectorAll(".popup"),y=document.querySelector("#deletePopup");function S(e){"Escape"===e.key&&L(document.querySelector(".popup_opened"))}function g(e){e.classList.add("popup_opened"),document.addEventListener("keydown",S)}function L(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",S)}const q={baseUrl:"https://nomoreparties.co/v1/wbc-cohort-1",headers:{authorization:"f3738230-a228-4435-8289-a861e5a04082","Content-Type":"application/json"}},C=e=>{console.log("Ошибка: "+e)},k=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),E=(e,t,r)=>fetch(`${q.baseUrl}/cards/likes/${t}`,{method:r,headers:q.headers,body:JSON.stringify({likes:e})}).then(k),x=(e,t,r)=>{((e,t)=>e.some((e=>!e.validity.valid)))(e)?(t.classList.add(r.inactiveButtonClass),t.disabled=!0):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)};function P(e){const t=document.querySelector("#card").content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__image"),o=t.querySelector(".card__like-button"),n=t.querySelector(".card__delete-button");t.querySelector(".card__title").textContent=e.name,t.querySelector(".card__likes").textContent=e.likes.length,r.alt=e.name,r.src=e.link,t._id=e._id;for(let t=0;t<e.likes.length;t++)e.likes[t]._id===U&&o.classList.add("card__like-button_active");return e.owner._id!==U?n.remove():n.addEventListener("click",(e=>{console.log(e.target.closest(".card")),function(e){var t;(t=e._id,fetch(`${q.baseUrl}/cards/${t}`,{method:"DELETE",headers:q.headers,body:JSON.stringify({id:t})}).then(k)).then((()=>{e.remove(),L(y)})).catch(C)}(e.target.closest(".card"))})),o.addEventListener("click",O),r.addEventListener("click",(()=>{return t=e.name,r=e.link,f.src=r,b.textContent=t,f.alt=t,void g(m);var t,r})),t}function $(e){i.append(e)}function O(e){if(e.target.classList.contains("card__like-button")){const t=e.target.closest(".card").querySelector(".card__likes");if(e.target.classList.contains("card__like-button_active")){const r="DELETE";E(U,e.target.closest(".card")._id,r).then((r=>{e.target.classList.toggle("card__like-button_active"),t.textContent=r.likes.length})).catch(C)}else{const r="PUT";E(U,e.target.closest(".card")._id,r).then((r=>{e.target.classList.toggle("card__like-button_active"),t.textContent=r.likes.length})).catch(C)}}}let U;var A;h.forEach((e=>{e.addEventListener("mousedown",(t=>{t.target.classList.contains("popup_opened")&&L(e),t.target.classList.contains("popup__close-button")&&L(e)}))})),_.addEventListener("click",(()=>{g(p)})),p.addEventListener("submit",(function(e){e.preventDefault();var t;(t=v.value,fetch(`${q.baseUrl}/users/me/avatar`,{method:"PATCH",headers:q.headers,body:JSON.stringify({avatar:t})}).then(k)).then((t=>{e.target.reset(),_.src=t.avatar,e.submitter.textContent="Сохранение...",L(p),e.submitter.classList.add("edit-form__save-button_disabled"),e.submitter.disabled=!0})).catch(C).finally((()=>{e.submitter.textContent="Сохранить"}))})),t.addEventListener("click",(()=>{d.value=o.textContent,u.value=n.textContent,g(l)})),l.addEventListener("submit",(function(e){e.preventDefault();const t=d.value,r=u.value;var a,s;o.textContent=t,n.textContent=r,(a=t,s=r,fetch(`${q.baseUrl}/users/me`,{method:"PATCH",headers:q.headers,body:JSON.stringify({name:a,about:s})}).then(k)).then((()=>{e.submitter.textContent="Сохранение...",L(l),e.submitter.classList.add("edit-form__save-button_disabled"),e.submitter.disabled=!0})).catch(C).finally((()=>{e.submitter.textContent="Сохранить"}))})),r.addEventListener("click",(()=>{g(a)})),a.addEventListener("submit",(function(e){e.preventDefault();var t,r;(t=s.value,r=c.value,fetch(`${q.baseUrl}/cards`,{method:"POST",headers:q.headers,body:JSON.stringify({name:t,link:r})}).then(k)).then((t=>{const r=P(t);e.target.reset(),e.submitter.textContent="Сохранение...",function(e){i.prepend(e)}(r),L(a),e.submitter.classList.add("edit-form__save-button_disabled"),e.submitter.disabled=!0})).catch(C).finally((()=>{e.submitter.textContent="Сохранить"}))})),A={formSelector:".edit-form",inputSelector:".edit-form__input-form",submitButtonSelector:".edit-form__save-button",inactiveButtonClass:"edit-form__save-button_disabled",inputErrorClass:"edit-form__input-form_type_error",errorClass:"edit-form__input-error_active"},Array.from(document.querySelectorAll(A.formSelector)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);x(r,o,t),r.forEach((n=>{n.addEventListener("input",(()=>{((e,t,r)=>{t.validity.valid?((e,t,r)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent=""})(e,t,r):((e,t,r,o)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)})(e,t,t.validationMessage,r)})(e,n,t),x(r,o,t)}))}))})(e,A)})),Promise.all([fetch(`${q.baseUrl}/users/me`,q).then(k),fetch(`${q.baseUrl}/cards`,{headers:q.headers}).then(k)]).then((([e,t])=>{U=e._id,o.textContent=e.name,n.textContent=e.about,_.src=e.avatar;for(let e=0;e<t.length;e++)$(P(t[e]))})).catch(C)})();
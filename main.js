(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){!function(e){e.classList.add("popup_fade"),setTimeout((function(){e.classList.remove("popup_fade")}),500)}(e),setTimeout((function(){e.classList.add("popup_hidden")}),500)}function o(e){e.classList.remove("popup_hidden")}function r(e){if(e.target.classList.contains("card__image")){const t=L.querySelector(".fullscreen__image"),r=L.querySelector(".fullscreen__title");t.src=e.target.parentNode.querySelector(".card__image").src,r.textContent=e.target.parentNode.querySelector(".card__title").textContent,o(L)}}function n(e){e.target.classList.contains("popup")&&0===e.button&&t(e.target)}e.d({},{bn:()=>h,JZ:()=>x,_u:()=>g,oQ:()=>$,VP:()=>P,qt:()=>S,lQ:()=>C,k3:()=>L,t0:()=>q,po:()=>k,SZ:()=>b,Zm:()=>v,b_:()=>j,ED:()=>y,rC:()=>f,xS:()=>d});const a=(e,t)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.classList.add("edit-form__save-button_disabled"),t.disabled=!0):(t.classList.remove("edit-form__save-button_disabled"),t.disabled=!1)};function c(e,t){const o=document.querySelector("#card").content.querySelector(".card").cloneNode(!0),n=o.querySelector(".card__image");return o.querySelector(".card__title").textContent=e,n.setAttribute("alt",e),n.src=t,o.addEventListener("click",l),o.addEventListener("click",i),o.addEventListener("click",r),o}function s(e){g.append(e)}function i(e){e.target.classList.contains("card__like-button")&&(e.target.classList.contains("card__like-button_active")?P(d,e.target.closest(".card").id).then((t=>{e.target.classList.remove("card__like-button_active"),e.target.closest(".card").querySelector(".card__likes").textContent=t.likes.length})).catch((e=>{console.log(e)})):x(d,e.target.closest(".card").id).then((t=>{e.target.classList.add("card__like-button_active"),e.target.closest(".card").querySelector(".card__likes").textContent=t.likes.length})).catch((e=>{console.log(e)})))}function l(e){e.target.classList.contains("card__delete-button")&&$(e.target.parentNode.id).then((t=>{e.target.parentNode.remove()}))}let d;const u=document.querySelector(".profile__edit-button"),_=document.querySelectorAll(".popup"),p=document.querySelector("#addButton"),m=document.querySelectorAll(".popup__close-button"),f=document.querySelector(".profile__name"),y=document.querySelector(".profile__description"),h=document.querySelector("#addFormPopup"),v=h.querySelector("#title-input"),b=h.querySelector("#url-input"),g=document.querySelector(".cards"),S=document.querySelector("#editFormPopup"),k=S.querySelector("#name-input"),q=S.querySelector("#job-input"),L=document.querySelector("#fullscreenImagePopup");for(let e=0;e<m.length;e++)m[e].addEventListener("click",(()=>{t(m[e].parentElement.parentElement)}));u.addEventListener("click",(()=>{k.value=f.textContent,q.value=y.textContent,o(S)})),S.addEventListener("submit",(function(e){e.preventDefault();const o=k.value,r=q.value;f.textContent=o,y.textContent=r,C(o,r).then((e=>e.json())).catch((e=>{console.log(e)})),t(S)})),p.addEventListener("click",(()=>{v.value="",b.value="",o(h)})),h.addEventListener("submit",(function(e){e.preventDefault();const o=v.value,r=b.value,n=c(o,r);j(o,r).then((e=>e.json())).catch((e=>{console.log(e)})),function(e){g.prepend(e)}(n),t(h)})),_.forEach((e=>{e.addEventListener("mousedown",n)})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&_.forEach(t)})),Array.from(document.querySelectorAll(".edit-form")).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),(e=>{const t=Array.from(e.querySelectorAll(".edit-form__input-form")),o=e.querySelector(".edit-form__save-button");a(t,o),t.forEach((r=>{r.addEventListener("input",(()=>{((e,t)=>{t.validity.valid?((e,t)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.remove("edit-form__input-form_type_error"),o.classList.remove("edit-form__input-error_active"),o.textContent=""})(e,t):((e,t,o)=>{const r=e.querySelector(`.${t.id}-error`);t.classList.add("edit-form__input-form_type_error"),r.textContent=o,r.classList.add("edit-form__input-error_active")})(e,t,t.validationMessage)})(e,r),a(t,o)}))}))})(e)}));const E={baseUrl:"https://nomoreparties.co/v1/wbc-cohort-1",headers:{authorization:"f3738230-a228-4435-8289-a861e5a04082","Content-Type":"application/json"}},C=(e,t)=>fetch(`${E.baseUrl}/users/me`,{method:"PATCH",headers:{authorization:"f3738230-a228-4435-8289-a861e5a04082","Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}),j=(e,t)=>fetch(`${E.baseUrl}/cards`,{method:"POST",headers:{authorization:"f3738230-a228-4435-8289-a861e5a04082","Content-Type":"application/json"},body:JSON.stringify({name:e,link:t})}),$=e=>fetch(`${E.baseUrl}/cards/${e}`,{method:"DELETE",headers:{authorization:"f3738230-a228-4435-8289-a861e5a04082","Content-Type":"application/json"},body:JSON.stringify({id:e})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))),x=(e,t)=>fetch(`${E.baseUrl}/cards/likes/${t}`,{method:"PUT",headers:{authorization:"f3738230-a228-4435-8289-a861e5a04082","Content-Type":"application/json"},body:JSON.stringify({likes:e})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))),P=(e,t)=>fetch(`${E.baseUrl}/cards/likes/${t}`,{method:"DELETE",headers:{authorization:"f3738230-a228-4435-8289-a861e5a04082","Content-Type":"application/json"},body:JSON.stringify({likes:e})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)));fetch(`${E.baseUrl}/users/me`,E).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>{f.textContent=e.name,y.textContent=e.about,d=e._id,console.log(e,d)})).catch((e=>{console.log(e)})),fetch(`${E.baseUrl}/cards`,E).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>{for(let t=0;t<e.length;t++){const o=c(e[t].name,e[t].link);o.id=e[t]._id,o.ownerId=e[t].owner._id,o.likes=e[t].likes.length,o.querySelector(".card__likes").textContent=o.likes;for(let r=0;r<o.likes;r++)e[t].likes[r]._id===d&&o.querySelector(".card__like-button").classList.add("card__like-button_active");o.ownerId!==d&&o.querySelector(".card__delete-button").classList.add("card__delete-button_disabled"),s(o)}})).catch((e=>{console.log(e)}))})();
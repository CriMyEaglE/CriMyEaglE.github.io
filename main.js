(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>P});const t=document.querySelector(".profile__edit-button"),r=document.querySelector("#addButton"),n=document.querySelector(".profile__name"),o=document.querySelector(".profile__description"),a=document.querySelector("#addFormPopup"),s=a.querySelector("#title-input"),c=a.querySelector("#url-input"),i=document.querySelector(".cards"),l=document.querySelector("#editFormPopup"),d=l.querySelector("#name-input"),u=l.querySelector("#job-input"),m=document.querySelector("#fullscreenImagePopup"),_=document.querySelector(".profile__avatar"),p=document.querySelector("#avatarPopup"),v=p.querySelector("#url-input"),b=m.querySelector(".fullscreen__image"),f=m.querySelector(".fullscreen__title"),h=document.querySelectorAll(".popup"),y=document.querySelector("#deletePopup");function S(e){"Escape"===e.key&&q(document.querySelector(".popup_opened"))}function L(e){e.classList.add("popup_opened"),document.addEventListener("keydown",S)}function q(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",S)}const g={baseUrl:"https://nomoreparties.co/v1/wbc-cohort-1",headers:{authorization:"f3738230-a228-4435-8289-a861e5a04082","Content-Type":"application/json"}},C=e=>{console.log("Ошибка: "+e)},k=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),E=(e,t,r)=>fetch(`${g.baseUrl}/cards/likes/${t}`,{method:r,headers:g.headers,body:JSON.stringify({likes:e})}).then(k),x=(e,t,r)=>{((e,t)=>e.some((e=>!e.validity.valid)))(e)?(t.classList.add(r.inactiveButtonClass),t.disabled=!0):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)};let P,$=null;function O(e){const t=document.querySelector("#card").content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__image"),n=t.querySelector(".card__like-button"),o=t.querySelector(".card__delete-button");t.querySelector(".card__title").textContent=e.name,t.querySelector(".card__likes").textContent=e.likes.length,r.alt=e.name,r.src=e.link,t._id=e._id;for(let t=0;t<e.likes.length;t++)e.likes[t]._id===P&&n.classList.add("card__like-button_active");return e.owner._id!==P?o.remove():o.addEventListener("click",(e=>{$=e.target.closest(".card"),L(y),y.addEventListener("submit",T)})),n.addEventListener("click",A),r.addEventListener("click",(()=>{return t=e.name,r=e.link,b.src=r,f.textContent=t,b.alt=t,void L(m);var t,r})),t}function U(e){i.append(e)}function A(e){if(e.target.classList.contains("card__like-button")){const t=e.target.closest(".card").querySelector(".card__likes");if(e.target.classList.contains("card__like-button_active")){const r="DELETE";E(P,e.target.closest(".card")._id,r).then((r=>{e.target.classList.toggle("card__like-button_active"),t.textContent=r.likes.length})).catch(C)}else{const r="PUT";E(P,e.target.closest(".card")._id,r).then((r=>{e.target.classList.toggle("card__like-button_active"),t.textContent=r.likes.length})).catch(C)}}}function T(){var e;(e=$._id,fetch(`${g.baseUrl}/cards/${e}`,{method:"DELETE",headers:g.headers,body:JSON.stringify({id:e})}).then(k)).then((()=>{$.remove(),q(y)})).then((()=>{$=null})).catch(C)}var j;h.forEach((e=>{e.addEventListener("mousedown",(t=>{t.target.classList.contains("popup_opened")&&q(e),t.target.classList.contains("popup__close-button")&&q(e)}))})),_.addEventListener("click",(()=>{L(p)})),p.addEventListener("submit",(function(e){e.preventDefault();var t;(t=v.value,fetch(`${g.baseUrl}/users/me/avatar`,{method:"PATCH",headers:g.headers,body:JSON.stringify({avatar:t})}).then(k)).then((t=>{e.target.reset(),_.src=t.avatar,e.submitter.textContent="Сохранение...",q(p),e.submitter.classList.add("edit-form__save-button_disabled"),e.submitter.disabled=!0})).catch(C).finally((()=>{e.submitter.textContent="Сохранить"}))})),t.addEventListener("click",(()=>{d.value=n.textContent,u.value=o.textContent,L(l)})),l.addEventListener("submit",(function(e){e.preventDefault();const t=d.value,r=u.value;var a,s;n.textContent=t,o.textContent=r,(a=t,s=r,fetch(`${g.baseUrl}/users/me`,{method:"PATCH",headers:g.headers,body:JSON.stringify({name:a,about:s})}).then(k)).then((()=>{e.submitter.textContent="Сохранение...",q(l),e.submitter.classList.add("edit-form__save-button_disabled"),e.submitter.disabled=!0})).catch(C).finally((()=>{e.submitter.textContent="Сохранить"}))})),r.addEventListener("click",(()=>{L(a)})),a.addEventListener("submit",(function(e){e.preventDefault();var t,r;(t=s.value,r=c.value,fetch(`${g.baseUrl}/cards`,{method:"POST",headers:g.headers,body:JSON.stringify({name:t,link:r})}).then(k)).then((t=>{const r=O(t);e.target.reset(),e.submitter.textContent="Сохранение...",function(e){i.prepend(e)}(r),q(a),e.submitter.classList.add("edit-form__save-button_disabled"),e.submitter.disabled=!0})).catch(C).finally((()=>{e.submitter.textContent="Сохранить"}))})),j={formSelector:".edit-form",inputSelector:".edit-form__input-form",submitButtonSelector:".edit-form__save-button",inactiveButtonClass:"edit-form__save-button_disabled",inputErrorClass:"edit-form__input-form_type_error",errorClass:"edit-form__input-error_active"},Array.from(document.querySelectorAll(j.formSelector)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);x(r,n,t),r.forEach((o=>{o.addEventListener("input",(()=>{((e,t,r)=>{t.validity.valid?((e,t,r)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""})(e,t,r):((e,t,r,n)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)})(e,t,t.validationMessage,r)})(e,o,t),x(r,n,t)}))}))})(e,j)})),Promise.all([fetch(`${g.baseUrl}/users/me`,g).then(k),fetch(`${g.baseUrl}/cards`,{headers:g.headers}).then(k)]).then((([e,t])=>{P=e._id,n.textContent=e.name,o.textContent=e.about,_.src=e.avatar;for(let e=0;e<t.length;e++)U(O(t[e]))})).catch(C)})();
(()=>{"use strict";const e=document.querySelector(".profile__edit-button"),t=document.querySelector("#addButton"),r=document.querySelector(".profile__name"),o=document.querySelector(".profile__description"),a=document.querySelector("#addFormPopup"),n=a.querySelector("#title-input"),s=a.querySelector("#url-input"),c=document.querySelector(".cards"),d=document.querySelector("#editFormPopup"),l=d.querySelector("#name-input"),i=d.querySelector("#job-input"),u=document.querySelector("#fullscreenImagePopup"),_=document.querySelector(".profile__avatar"),m=document.querySelector("#avatarPopup"),v=m.querySelector("#url-input"),f=u.querySelector(".fullscreen__image"),p=u.querySelector(".fullscreen__title"),y=document.querySelectorAll(".popup");function b(e){!function(e){e.classList.add("popup_fade"),setTimeout((function(){e.classList.remove("popup_fade")}),500)}(e),setTimeout((function(){e.classList.remove("popup_opened")}),500)}function h(e){e.classList.add("popup_opened"),e.addEventListener("keydown",g)}function S(e){e.target.classList.contains("card__image")&&(f.src=e.target.parentNode.querySelector(".card__image").src,p.textContent=e.target.parentNode.querySelector(".card__title").textContent,f.setAttribute("alt",e.target.parentNode.querySelector(".card__image").src),h(u))}function g(e){if("Escape"===e.key){const e=document.querySelector(".popup_opened");b(e),e.removeEventListener("keydown",g)}}const q={baseUrl:"https://nomoreparties.co/v1/wbc-cohort-1",headers:{authorization:"f3738230-a228-4435-8289-a861e5a04082","Content-Type":"application/json"}},L=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`);let k;fetch(`${q.baseUrl}/users/me`,{headers:q.headers}).then(L).then((e=>{k=e._id}));const C=(e,t,r)=>{((e,t)=>e.some((e=>!e.validity.valid)))(e)?(t.classList.add(r.inactiveButtonClass),t.disabled=!0):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)};function E(e,t){const r=document.querySelector("#card").content.querySelector(".card").cloneNode(!0),o=r.querySelector(".card__image");return r.querySelector(".card__title").textContent=e,o.setAttribute("alt",e),o.src=t,r.addEventListener("click",U),r.addEventListener("click",$),r.addEventListener("click",S),r}function x(e){c.append(e)}function $(e){e.target.classList.contains("card__like-button")&&(e.target.classList.contains("card__like-button_active")?((e,t)=>fetch(`${q.baseUrl}/cards/likes/${t}`,{method:"DELETE",headers:q.headers,body:JSON.stringify({likes:e})}).then(L))(k,e.target.closest(".card").id).then((t=>{e.target.classList.remove("card__like-button_active"),e.target.closest(".card").querySelector(".card__likes").textContent=t.likes.length})).catch((e=>{console.log(e)})):((e,t)=>fetch(`${q.baseUrl}/cards/likes/${t}`,{method:"PUT",headers:q.headers,body:JSON.stringify({likes:e})}).then(L))(k,e.target.closest(".card").id).then((t=>{e.target.classList.add("card__like-button_active"),e.target.closest(".card").querySelector(".card__likes").textContent=t.likes.length})).catch((e=>{console.log(e)})))}function U(e){var t;e.target.classList.contains("card__delete-button")&&(t=e.target.closest(".card").id,fetch(`${q.baseUrl}/cards/${t}`,{method:"DELETE",headers:q.headers,body:JSON.stringify({id:t})}).then(L)).then((t=>{e.target.closest(".card").remove()}))}var N;y.forEach((e=>{e.addEventListener("mousedown",(t=>{t.target.classList.contains("popup_opened")&&b(e),t.target.classList.contains("popup__close-button")&&b(e)}))})),_.addEventListener("click",(()=>{m.querySelector(".edit-form__save-button").textContent="Сохранить",v.value="",h(m)})),m.addEventListener("submit",(function(e){e.preventDefault();const t=v.value;var r;e.target.querySelector(".edit-form__save-button").textContent="Сохранение...",(r=t,fetch(`${q.baseUrl}/users/me/avatar`,{method:"PATCH",headers:q.headers,body:JSON.stringify({avatar:r})}).then(L)).then((e=>{_.src=e.avatar})).catch((e=>{console.log(e)})),b(m),e.target.querySelector(".edit-form__save-button").classList.add("edit-form__save-button_disabled"),e.target.querySelector(".edit-form__save-button").disabled=!0})),e.addEventListener("click",(()=>{d.querySelector(".edit-form__save-button").textContent="Сохранить",l.value=r.textContent,i.value=o.textContent,h(d)})),d.addEventListener("submit",(function(e){e.preventDefault();const t=l.value,a=i.value;var n,s;r.textContent=t,o.textContent=a,e.target.querySelector(".edit-form__save-button").textContent="Сохранение...",(n=t,s=a,fetch(`${q.baseUrl}/users/me`,{method:"PATCH",headers:q.headers,body:JSON.stringify({name:n,about:s})}).then(L)).catch((e=>{console.log(e)})),b(d),e.target.querySelector(".edit-form__save-button").classList.add("edit-form__save-button_disabled"),e.target.querySelector(".edit-form__save-button").disabled=!0})),t.addEventListener("click",(()=>{a.querySelector(".edit-form__save-button").textContent="Сохранить",n.value="",s.value="",h(a)})),a.addEventListener("submit",(function(e){e.preventDefault();const t=n.value,r=s.value,o=E(t,r);var d,l;e.target.querySelector(".edit-form__save-button").textContent="Сохранение...",(d=t,l=r,fetch(`${q.baseUrl}/cards`,{method:"POST",headers:q.headers,body:JSON.stringify({name:d,link:l})}).then(L)).then((e=>{console.log(e),o.id=e._id})).catch((e=>{console.log(e)})),function(e){c.prepend(e)}(o),b(a),e.target.querySelector(".edit-form__save-button").classList.add("edit-form__save-button_disabled"),e.target.querySelector(".edit-form__save-button").disabled=!0})),document.addEventListener("keydown",g),N={formSelector:".edit-form",inputSelector:".edit-form__input-form",submitButtonSelector:".edit-form__save-button",inactiveButtonClass:"edit-form__save-button_disabled",inputErrorClass:"edit-form__input-form_type_error",errorClass:"edit-form__input-error_active"},Array.from(document.querySelectorAll(N.formSelector)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);C(r,o,t),r.forEach((a=>{a.addEventListener("input",(()=>{((e,t,r)=>{t.validity.valid?((e,t,r)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent=""})(e,t,r):((e,t,r,o)=>{const a=e.querySelector(`.${t.id}-error`);t.classList.add(o.inputErrorClass),a.textContent=r,a.classList.add(o.errorClass)})(e,t,t.validationMessage,r)})(e,a,t),C(r,o,t)}))}))})(e,N)})),fetch(`${q.baseUrl}/users/me`,q).then(L).then((e=>{r.textContent=e.name,o.textContent=e.about,_.src=e.avatar})).catch((e=>{console.log(e)})),fetch(`${q.baseUrl}/cards`,{headers:q.headers}).then(L).then((e=>{for(let t=0;t<e.length;t++){const r=E(e[t].name,e[t].link);r.id=e[t]._id,r.ownerId=e[t].owner._id,r.likes=e[t].likes.length,r.querySelector(".card__likes").textContent=r.likes;for(let o=0;o<r.likes;o++)e[t].likes[o]._id===k&&r.querySelector(".card__like-button").classList.add("card__like-button_active");r.ownerId!==k&&r.querySelector(".card__delete-button").classList.add("card__delete-button_disabled"),x(r)}})).catch((e=>{console.log(e)}))})();
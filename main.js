(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>j});const t=document.querySelector(".profile__edit-button"),r=document.querySelector("#addButton"),n=document.querySelector(".profile__name"),o=document.querySelector(".profile__description"),a=document.querySelector("#addFormPopup"),s=a.querySelector("#title-input"),c=a.querySelector("#url-input"),i=document.querySelector(".cards"),l=document.querySelector("#editFormPopup"),d=l.querySelector("#name-input"),u=l.querySelector("#job-input"),m=document.querySelector("#fullscreenImagePopup"),p=document.querySelector(".profile__avatar"),_=document.querySelector("#avatarPopup"),v=_.querySelector("#url-input"),f=m.querySelector(".fullscreen__image"),h=m.querySelector(".fullscreen__title"),y=document.querySelectorAll(".popup"),b=document.querySelector("#deletePopup");function S(e){"Escape"===e.key&&L(document.querySelector(".popup_opened"))}function q(e){e.classList.add("popup_opened"),document.addEventListener("keydown",S)}function L(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",S)}const g={baseUrl:"https://nomoreparties.co/v1/wbc-cohort-1",headers:{authorization:"f3738230-a228-4435-8289-a861e5a04082","Content-Type":"application/json"}},k=e=>{console.log("Ошибка: "+e)},E=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),C=(e,t,r)=>fetch(`${g.baseUrl}/cards/likes/${t}`,{method:r,headers:g.headers,body:JSON.stringify({likes:e})}).then(E);let x=null;function P(e){const t=document.querySelector("#card").content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__image"),n=t.querySelector(".card__like-button"),o=t.querySelector(".card__delete-button");t.querySelector(".card__title").textContent=e.name,t.querySelector(".card__likes").textContent=e.likes.length,r.alt=e.name,r.src=e.link,t._id=e._id;for(let t=0;t<e.likes.length;t++)e.likes[t]._id===j&&n.classList.add("card__like-button_active");return e.owner._id!==j?o.remove():o.addEventListener("click",(e=>{x=e.target.closest(".card"),q(b)})),n.addEventListener("click",O),r.addEventListener("click",(()=>{return t=e.name,r=e.link,f.src=r,h.textContent=t,f.alt=t,void q(m);var t,r})),t}function $(e){i.append(e)}function O(e){if(e.target.classList.contains("card__like-button")){const t=e.target.closest(".card"),r=t.querySelector(".card__likes");if(e.target.classList.contains("card__like-button_active")){const n="DELETE";C(j,t._id,n).then((t=>{e.target.classList.toggle("card__like-button_active"),r.textContent=t.likes.length})).catch(k)}else{const n="PUT";C(j,t._id,n).then((t=>{e.target.classList.toggle("card__like-button_active"),r.textContent=t.likes.length})).catch(k)}}}function U(e,t="Сохранить"){e.textContent=t}function A(e){e.classList.add("edit-form__save-button_disabled"),e.disabled=!0}b.addEventListener("submit",(function(e){var t;U(e.submitter,"Удаление..."),(t=x._id,fetch(`${g.baseUrl}/cards/${t}`,{method:"DELETE",headers:g.headers,body:JSON.stringify({id:t})}).then(E)).then((()=>{x.remove(),L(b)})).then((()=>{x=null})).catch(k).finally((()=>{U(e.submitter,"Да")}))}));const T=(e,t,r)=>{((e,t)=>e.some((e=>!e.validity.valid)))(e)?(t.classList.add(r.inactiveButtonClass),t.disabled=!0):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)};let j;var w;y.forEach((e=>{e.addEventListener("mousedown",(t=>{t.target.classList.contains("popup_opened")&&L(e),t.target.classList.contains("popup__close-button")&&L(e)}))})),p.addEventListener("click",(()=>{q(_)})),_.addEventListener("submit",(function(e){e.preventDefault();const t=v.value;var r;U(e.submitter,"Сохранение..."),(r=t,fetch(`${g.baseUrl}/users/me/avatar`,{method:"PATCH",headers:g.headers,body:JSON.stringify({avatar:r})}).then(E)).then((t=>{e.target.reset(),p.src=t.avatar,L(_),A(e.submitter)})).catch(k).finally((()=>{U(e.submitter)}))})),t.addEventListener("click",(()=>{d.value=n.textContent,u.value=o.textContent,q(l)})),l.addEventListener("submit",(function(e){e.preventDefault();const t=d.value,r=u.value;var a,s;n.textContent=t,o.textContent=r,U(e.submitter,"Сохранение..."),(a=t,s=r,fetch(`${g.baseUrl}/users/me`,{method:"PATCH",headers:g.headers,body:JSON.stringify({name:a,about:s})}).then(E)).then((()=>{L(l),A(e.submitter)})).catch(k).finally((()=>{U(e.submitter)}))})),r.addEventListener("click",(()=>{q(a)})),a.addEventListener("submit",(function(e){e.preventDefault();const t=s.value,r=c.value;var n,o;U(e.submitter,"Сохранение..."),(n=t,o=r,fetch(`${g.baseUrl}/cards`,{method:"POST",headers:g.headers,body:JSON.stringify({name:n,link:o})}).then(E)).then((t=>{const r=P(t);e.target.reset(),function(e){i.prepend(e)}(r),L(a),A(e.submitter)})).catch(k).finally((()=>{U(e.submitter)}))})),w={formSelector:".edit-form",inputSelector:".edit-form__input-form",submitButtonSelector:".edit-form__save-button",inactiveButtonClass:"edit-form__save-button_disabled",inputErrorClass:"edit-form__input-form_type_error",errorClass:"edit-form__input-error_active"},Array.from(document.querySelectorAll(w.formSelector)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);T(r,n,t),r.forEach((o=>{o.addEventListener("input",(()=>{((e,t,r)=>{t.validity.valid?((e,t,r)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""})(e,t,r):((e,t,r,n)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)})(e,t,t.validationMessage,r)})(e,o,t),T(r,n,t)}))}))})(e,w)})),Promise.all([fetch(`${g.baseUrl}/users/me`,g).then(E),fetch(`${g.baseUrl}/cards`,{headers:g.headers}).then(E)]).then((([e,t])=>{j=e._id,n.textContent=e.name,o.textContent=e.about,p.src=e.avatar;for(let e=0;e<t.length;e++)$(P(t[e]))})).catch(k)})();